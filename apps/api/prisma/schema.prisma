// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ProjectCategory {
  EMPRESA   @map("Empresa")
  PERSONAL  @map("Personal")
  FREELANCE @map("Freelance")
}

enum ProjectPriority {
  ALTA  @map("Alta")
  MEDIA @map("Media")
  BAJA  @map("Baja")
}

enum ProjectStatus {
  ACTIVO     @map("Activo")
  FINALIZADO @map("Finalizado")
  PAUSA      @map("Pausa")
  PENDIENTE  @map("Pendiente")
}

model User {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                    String    @unique @db.VarChar(255)
  password_hash            String    @db.VarChar(255)
  name                     String?   @db.VarChar(255)
  is_admin                 Boolean   @default(false)
  refresh_token_hash       String?   @db.VarChar(255)
  refresh_token_expires_at DateTime? @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime? @updatedAt @db.Timestamptz(6)

  projects     Project[]
  time_entries TimeEntry[]
  deliverables Deliverable[]

  @@index([refresh_token_hash])
  @@map("users")
}

model Project {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String          @db.Uuid
  name            String          @db.VarChar(255)
  client          String?         @db.VarChar(255)
  category        ProjectCategory
  priority        ProjectPriority
  status          ProjectStatus
  hours_spent     Float           @default(0)
  hours_estimated Float?
  deadline        DateTime?       @db.Timestamptz(6)
  description     String?         @db.Text
  created_at      DateTime        @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?       @updatedAt @db.Timestamptz(6)

  time_entries TimeEntry[]
  deliverables Deliverable[]
  user          User        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("projects")
}

model TimeEntry {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String    @db.Uuid
  project_id    String    @db.Uuid
  activity_type String    @db.VarChar(100)
  description   String    @db.Text
  date          DateTime  @db.Timestamptz(6)
  duration      Int
  end_time      DateTime? @db.Timestamptz(6)
  created_at    DateTime  @default(now()) @db.Timestamptz(6)

  project Project @relation(fields: [project_id], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([project_id])
  @@index([user_id])
  @@map("time_entries")
}

model Deliverable {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  project_id String    @db.Uuid
  title      String    @db.VarChar(255)
  deadline   DateTime? @db.Timestamptz(6)
  completed  Boolean   @default(false)
  created_at DateTime  @default(now()) @db.Timestamptz(6)

  project Project @relation(fields: [project_id], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([project_id])
  @@index([user_id])
  @@map("deliverables")
}
